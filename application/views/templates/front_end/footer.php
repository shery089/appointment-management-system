<!-- Footer Section
================================= -->
<!-- Footer Top Strip -->
	<div class="top-strip white-bg">
    	<div class="container">
            <div class="row vertical-align">
                    
                <div class="col-md-8 vertical-middle visible-block-sm-xs marbot30-sm-xs">
                    <div class="text-center marbot0 media">
                        <span class="media-left"><i class="fa fa-phone icon-bordered"></i></span>
                        <span class="media-body text-left media-middle">
                            If you Have Any Questions Call Us On <a href="javascript:void(0)"><span class="bold"> <?= PHONE_NUMBER ?></span></a>                
                        </span>
                    </div> 
                </div>
                
                <div class="col-md-4 vertical-middle visible-block-sm-xs text-center animatedParent animateOnce">
                    <a href="<?= site_url('f/appointment/') ?>" class="btn btn-type1-reverse pulse animated"> Make an Appointment</a>
                </div>
            </div>
        </div>
    </div>
<!-- Footer Top Strip -->
    
<footer id="footer">
	<div class="footer">
        <!-- Footer Content -->
        <div class="container">
                <div class="text-center marbot50">
                    <div class="clearfix social-icons-simple footer-social-bg social-icons-lg text-center marbot30">
                        <ul>
                          <li data-html="true" title="Facebook" data-toggle="tooltip"><a href="https://www.facebook.com/sheryar.ahmed.089"><i class="fa fa-facebook"></i></a></li>
                          <li data-html="true" title="Twitter" data-toggle="tooltip"><a href="javascript:void(0)"><i class="fa fa-twitter"></i></a></li>
                      </ul>
                    </div>
                
                    <div class="footer-menu marbot30">
                        <ul class="list-unstyled list-inline">
                        <li>
                            <a href="<?= site_url('f/home') ?>" role="button">Home </a>
                        </li>

                        <li>
                            <a href="<?= site_url('f/about') ?>" role="button">About us </a>
                        </li>

                        <li>
                            <a href="<?= site_url('f/doctor') ?>" role="button">Doctors List </a>
                        </li>

                        <li>
                            <a href="appointment.html">Schedule Appointment </a>
                        </li>
                        </ul>
                    </div>
    
                    <div class="copyright text-center marbot30-md-xs">
                        Copyright &copy; 2016 <?= (date('Y') > '2016') ? ' - ' . date('Y') . ' ': '' ?><span class="bold">Ready Care &reg;</span>. All Rights Reserved.                  </div>
                </div>
        </div>
        <!-- Footer Content -->
        
    <!-- Back To Top -->
        <div class="footer-strip animatedParent">
            <a href="#" data-html="true" title="Back To Top" data-toggle="tooltip" class="back-to-top text-center"> 
                <i class="fa fa-angle-double-up transition fadeInUp animated"></i>
            </a>
          <div class="footer-bottom-border"></div>
        </div>
        <!-- // Back To Top -->
    </div>
</footer>
<!-- // Footer Section
================================= -->

</div>
<!-- // Wrapper 
=============================-->

<!-- Java Scripts
================================= -->

<!-- Common Scripts -->
<script type="text/javascript" src="<?= FRONT_END_ASSETS ?>js/bootstrap.min.js"></script>
<script type="text/javascript" src="<?= FRONT_END_ASSETS ?>js/jquery.validate.min.js"></script>
<script type="text/javascript" src="<?= FRONT_END_ASSETS ?>js/jquery.easing-1.3.min.js"></script>
<script type="text/javascript" src="<?= FRONT_END_ASSETS ?>js/jquery.slicknav.min.js"></script>

<!-- Smooth Scroll -->
<script type="text/javascript" src="<?= FRONT_END_ASSETS ?>js/sscr.js"></script>
<!-- // Smooth Scroll -->

<!-- Preloader Starts -->
<script type="text/javascript" src="<?= FRONT_END_ASSETS ?>js/jpreloader.min.js"></script>
<!-- Preloader End -->

<!-- Light Box JS -->
<script type="text/javascript" src="<?= FRONT_END_ASSETS ?>js/ekko-lightbox.min.js"></script>
<!-- // Light Box JS -->

<!-- Image Hover Overlay Effect -->
<script type="text/javascript" src="<?= FRONT_END_ASSETS ?>js/modernizr-2.8.3.min.js"></script>	
<script type="text/javascript" src="<?= FRONT_END_ASSETS ?>js/jquery.hoverdir.js"></script>	
<!-- // Image Hover Overlay Effect -->

<!-- // Common Scripts -->

<!-- Date And Time Picker -->
<script type="text/javascript" src="<?= FRONT_END_ASSETS ?>js/bootstrap-datetimepicker.min.js"></script>
<!-- // Date And Time Picker -->

<!-- Google Map -->
<!--<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script type="text/javascript" src="assets/js/custom-google-map.js"></script>-->
<!-- // Google Map -->

<!-- Twenty Twenty Slider -->
<script type="text/javascript" src="<?= FRONT_END_ASSETS ?>js/jquery.event.move.js"></script>
<script type="text/javascript" src="<?= FRONT_END_ASSETS ?>js/jquery.twentytwenty.js"></script>
<!-- // Twenty Twenty Slider -->

<!-- Owl Slider JS -->
<script type="text/javascript" src="<?= FRONT_END_ASSETS ?>js/owl.carousel.min.js"></script>
<script type="text/javascript" src="<?= FRONT_END_ASSETS ?>js/custom-owl.js"></script>
<!-- // Owl Slider JS -->

<!-- BX Slider JS -->
<script type="text/javascript" src="<?= FRONT_END_ASSETS ?>js/jquery.bxslider.min.js"></script>
<script type="text/javascript" src="<?= FRONT_END_ASSETS ?>js/custom-bxslider.js"></script>
<script type="text/javascript" src="<?= FRONT_END_ASSETS ?>js/jquery.isotope.min.js"></script>
<!-- // BX Slider JS -->

<!-- Revolution Slider 4.6.5 -->
<script type="text/javascript" src="<?= FRONT_END_ASSETS ?>revolution-4.6.5/js/jquery.themepunch.tools.min.js"></script>
<script type="text/javascript" src="<?= FRONT_END_ASSETS ?>revolution-4.6.5/js/jquery.themepunch.revolution.min.js"></script>
<script type="text/javascript" src="<?= FRONT_END_ASSETS ?>revolution-4.6.5/js/custom-renovation-slide-thumbs.js"></script>
<!-- Revolution Slider 4.6.5 -->
    
<!-- Bootstrap Select -->
<script src="<?= ADMIN_ASSETS ?>bootstrap-select/dist/js/bootstrap-select.js"></script>

<script src="<?= ADMIN_ASSETS ?>bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
    
<script src="<?= ADMIN_ASSETS ?>fullcalendar-2.9.0/lib/moment.min.js"></script>

<script src="<?= ADMIN_ASSETS ?>jquery-ui/jquery-ui.min.js"></script>

<script src="<?= ADMIN_ASSETS ?>timepicki/js/timepicki.js"></script>

<script>
// DOM  starts here 

jQuery(document).ready(function($){
"use strict"; 
// Preloaer Script
jQuery("body").jpreLoader(
	  {
		splashID:"#jSplash",
		showPercentage:!0,
		autoClose:!0,
		showSplash: true,
		splashFunction:function(){
		$("#sk-spinner").delay(1250).animate({opacity:1},700,"linear");
 		}
    });

// dom END

});

$(window).load(function(){
    var controller = "<?= $this->uri->segment(3); ?>";
    if(controller === 'add_appointment_lookup')
    {
        if("<?= !empty($this->session->flashdata('success_message')); ?>")
        {
            $('#morning_shift').attr('value', '');
            $('#evening_shift').attr('value', '');
            $('#submitted_date_1').attr('value', '');
        }
    }    

    var controller = "<?= $this->uri->segment(3); ?>";

    if(controller === 'add_appointment_old_lookup')
    {
        $('#pill_1').parent().attr('class', '');
        $('#pill_2').parent().attr('class', 'active');
        $('#new_patient').removeClass('active');
        $('#old_patient').addClass('active');
        if("<?= !empty($this->session->flashdata('success_message_2')); ?>")
        {
            $('#morning_shift_2').attr('value', '');
            $('#evening_shift_2').attr('value', '');
            $('#submitted_date_2').attr('value', '');
        }
    }

    $('#old_patient').trigger("reset");
    $('#appointment-form').trigger("reset");
    
    var method = "<?= $this->uri->segment(3) ?>";
    if(method == 'appointment_by_id_lookup')
    {
        $('#doctor').attr('disabled', true);
    }

    function todayDate()
    {
        var today_date = new Date();
        var month = today_date.getMonth()+1;
        var day = today_date.getDate();
        var today_date = today_date.getFullYear() + '-' +
            ((''+month).length < 2 ? '0' : '') + month + '-' +
            ((''+day).length < 2 ? '0' : '') + day;
        return today_date;
    }

    function currentYear()
    {
        var dateToday = new Date();
        var yrCurrent = dateToday.getFullYear();
        return yrCurrent;
    }

    function checkAvailableSchedule(doctor_id, date, time)
    {
        $.ajax({

            url: '/ams/f/appointment/check_avaiable_schedule/',
            method: 'post',
            data: {'doctor_id': doctor_id, 'date': date, 'time': time},
            success: function(data) 
            {
                jQuery('body').append(data);
                $("#modal").modal({backdrop: "static", toggle: true});
            },
            error: function()
            {
                alert('Something went wrong!');
            }
        });
    }

    function searchDoctor(specialization)
    {
        $.ajax({

            url: '/ams/f/doctor/display_doctor_by_keys/',
            method: 'post',
            data: {'specialization': specialization},
            success: function(data)
            {
                jQuery('#searched_doctors').html(data);
            },
            error: function()
            {
                alert('Something went wrong!');
            }
        });
    }        

    function todayDate()
    {
        var today_date = new Date();
        return today_date;
    }

    function formatDate(date)
    {   
        var month = date.getMonth()+1;
        var day = date.getDate();
        var date = date.getFullYear() + '-' +
            ((''+month).length < 2 ? '0' : '') + month + '-' +
            ((''+day).length < 2 ? '0' : '') + day;
        return date;
    }

/*    Date.prototype.addDays = function(days) 
    {
        var dat = new Date(this.valueOf())
        dat.setDate(dat.getDate() + days);
        return dat;
    }*/


    function time_picker(id, min_hour_value = 8, max_hour_value = 23, start_hour = 08, start_min = 00)
    {
        $(id).timepicki({
            show_meridian:false,
            min_hour_value:min_hour_value,
            max_hour_value:max_hour_value,
            step_size_minutes:15,
            overflow_minutes:true,
            increase_direction:'up',
            start_time: [start_hour, start_min],
            disable_keyboard_mobile: true
        });
    }

    function getDates(minDate, maxDate) 
    {
        var dateArray = new Array();
        // var currentDate = minDate;
        var x = 0;
        var today = todayDate();
        // var today = formatDate(today);
        
        while (x <= 6) 
        {
            dateArray.push( formatDate(new Date (today.getFullYear(), today.getMonth(), today.getDate() + x)))
            // currentDate = currentDate.addDays(1);
            x++;
        }
        return dateArray;
    }

    function getDoctorShifts(doctor_id, date)
    {

        $.ajax({
            url: '/ams/f/schedule/get_schedule_by_doc_id_lookup/' + doctor_id,
            method: 'post',
            data: {'date': date},
            success: function(data)
            {
                var data = jQuery.parseJSON(data);
                var data = data[0];
                var f_s_s_parts = data.first_shift_start.split(':');
                var f_s_e_parts = data.first_shift_end.split(':');
                var s_s_s_parts = data.second_shift_start.split(':');
                var s_s_e_parts = data.second_shift_end.split(':');
                time_picker('#morning_shift, #morning_shift_2', f_s_s_parts[0], f_s_e_parts[0], f_s_s_parts[0], f_s_s_parts[1]);
                time_picker('#evening_shift, #evening_shift_2', s_s_s_parts[0], s_s_e_parts[0], s_s_s_parts[0], s_s_s_parts[1]);

            },
            error: function()
            {
                alert('Something went wrong!');
            }
        });
    }

    function availableSlots(availableDates)
    {

        var today = todayDate();
        var today_date = formatDate(today);

        var nextweek = new Date(today.getFullYear(), today.getMonth(), today.getDate()+6);
        nextweek = formatDate(nextweek); 
        
        var week_days = getDates();
        
        // console.log(week_days);
        
        
        availableDates = availableDates.filter( function( el ) {
        
          return !week_days.includes( el );
        } );

        console.log(availableDates);

        // var m = date.getMonth(), d = date.getDate(), y = date.getFullYear();
        // //console.log('Checking (raw): ' + m + '-' + d + '-' + y);
        // for (i = 0; i < disabledDays.length; i++) {
        //     if($.inArray((m+1) + '-' + d + '-' + y,disabledDays) != -1 || new Date() > date) {
        //         //console.log('bad:  ' + (m+1) + '-' + d + '-' + y + ' / ' + disabledDays[i]);
        //         return [false];
        //     }
        // }
        // //console.log('good:  ' + (m+1) + '-' + d + '-' + y);
        // return [true];
    }

/*    function getDoctorSchedule(id)
    {
        $.ajax({

            url: '/ams/f/schedule/get_schedules_by_doc_id_lookup/' + id,
            success: function(data)
            {
                var active_dates = jQuery.parseJSON(data);
                var availableDates = [];
                for (x in active_dates) {
                    availableDates.push(active_dates[x].date);
                }
                    // availableSlots(availableDates);

                // var availableDates = ["9-5-2011","14-5-2011","15-5-2011"];
                $("#submitted_date").datepicker({dateFormat: 'yy-mm-dd', minDate: 0, maxDate: 6, beforeShowDay: availableSlots(availableDates)}).attr('readonly','readonly');
            },
            error: function()
            {
                alert('Something went wrong!');
            }
        });
    }   */     

        $(".alert-dismissable").fadeTo(100000, 500).slideUp(500, function(){
        $(".alert-dismissable").alert('close');
        });

    $('#morning_shift').on('focus', function(){
        $('#evening_shift').val('');
        $('#evening_shift').removeAttr('data-timepicki-tim');
        $('#evening_shift').removeAttr('data-timepicki-mini');
        // $('#evening_shift').trigger('change');
        // $('#evening_shift').val('')
    });

    $('#evening_shift').on('focus', function(){
        $('#morning_shift').removeAttr('data-timepicki-tim');
        $('#morning_shift').removeAttr('data-timepicki-mini');


    });

    $('#pill_1').on('click', function(){
        $('#old_patient').trigger("reset");
        $('#appointment-form').trigger("reset");
    });
    
    $('#pill_2').on('click', function(){
        $('#old_patient').trigger("reset");
        $('#appointment-form').trigger("reset");
    });


    $("#birthday").datepicker({dateFormat: 'yy-mm-dd', changeYear: true, changeMonth: true, minDate: -1893434400 ,maxDate: todayDate(), yearRange : '1910:' + currentYear()}).attr('readonly','readonly');

    // updates doctor selectpicker if there is no doctors available at selected date

    $('#book1').on('click', function(){
        $('#morning_shift_cb').attr('checked', false);
        $('#evening_shift_cb').attr('checked', false);
        $('#evening_shift').attr('disabled', false);
        $('#morning_shift').attr('disabled', false);
        setTimeout(function(){
            $('#evening_shift').attr('disabled', true);
            $('#morning_shift').attr('disabled', true);
        }, 1000);

    });

    $('#book2').on('click', function(){
        $('#morning_shift_cb_2').attr('checked', false);
        $('#evening_shift_cb_2').attr('checked', false);
        $('#evening_shift_2').attr('disabled', false);
        $('#morning_shift_2').attr('disabled', false);
        setTimeout(function(){
            $('#evening_shift_2').attr('disabled', true);
            $('#morning_shift_2').attr('disabled', true);
        }, 1000);

    });

    if($('#doctor').on('change', function(){
        var doctor_id = $('#doctor').val();
        if(doctor_id == 0)
        {
            $('#doctor').val('').trigger('chosen:updated');
            $('#doctor').selectpicker('refresh');
        }
        else
        {
            $('#morning_shift').val('');
            $('#evening_shift').val('');
            $('#morning_shift').attr('readonly', false);
            $('#evening_shift').attr('readonly', false);
            $('#morning_shift_cb').attr('checked', false);
            $('#evening_shift_cb').attr('checked', false);
            getDoctorShifts($('#doctor').val(), $('#submitted_date_1').val());
        }
    }));

    if($('#doctor_old').on('change', function(){
        var doctor_id = $('#doctor_old').val();
        if(doctor_id == 0)
        {
            $('#doctor_old').val('').trigger('chosen:updated');
            $('#doctor_old').selectpicker('refresh');
        }
        else
        {
            $('#morning_shift_cb_2').attr('checked', false);
            $('#evening_shift_cb_2').attr('checked', false);
            getDoctorShifts($('#doctor_old').val(), $('#submitted_date_2').val());
        }
    }));

    //$('#morning_shift').attr('disabled', false);
    //$('#evening_shift').attr('disabled', false);

    $("#morning_shift_cb").change(function() {
        if(this.checked) 
        {
            $('#evening_shift').attr('disabled', true);
            $('#morning_shift').attr('disabled', false);
            $('#morning_shift').val('');
            $('#evening_shift').val('');
            $('#evening_shift_cb').attr('checked', false);
        }
    });                    
    
    $("#evening_shift_cb").change(function() {
        if(this.checked) 
        {
            $('#morning_shift').attr('disabled', true);
            $('#evening_shift').attr('disabled', false);
            $('#morning_shift').val('');                            
            $('#evening_shift').val('');
            $('#morning_shift_cb').attr('checked', false);
        }
    });


    $("#morning_shift_cb_2").change(function() {
        if(this.checked) 
        {
            $('#evening_shift_2').attr('disabled', true);
            $('#morning_shift_2').attr('disabled', false);
            $('#morning_shift_2').val('');
            $('#evening_shift_2').val('');
            $('#evening_shift_cb_2').attr('checked', false);
        }
    });                    
    
    
    $("#evening_shift_cb_2").change(function() {
        if(this.checked) 
        {
            $('#morning_shift_2').attr('disabled', true);
            $('#evening_shift_2').attr('disabled', false);
            $('#morning_shift_2').val('');                            
            $('#evening_shift_2').val('');
            $('#morning_shift_cb_2').attr('checked', false);
        }
    });
    
    // $("#morning_shift").on('change', function() {
    //     alert($("#morning_shift").val());
    //     if($("#morning_shift").val() !== '')
    //     {
    //         var doctor = $('#doctor').val();
    //         var date = $('#submitted_date_1').val();
    //         var morning_shift = $('#morning_shift').val();
    //         checkAvailableSchedule(doctor, date, morning_shift);
    //     }

    // });

    // $("#evening_shift").on('change', function() {
    //             alert();
    //     if($("#evening_shift").val() !== '')
    //     {
    //         var doctor = $('#doctor').val();
    //         var date = $('#submitted_date_1').val();
    //         var evening_shift = $('#evening_shift').val();
    //         checkAvailableSchedule(doctor, date, evening_shift);
    //     }   

    // });

    $('#book1').on('click', function(e)
    {
        var doctor = $('#doctor').val();
        
        var date = $('#submitted_date_1').val();
        
        var evening_shift = $('#evening_shift').val();
        
        if(doctor !== 0 && date !== '' && evening_shift !== '')
        {
            checkAvailableSchedule(doctor, date, evening_shift, e);
        }
        else
        {
            var morning_shift = $('#morning_shift').val();
            
            if(doctor !== 0 && date !== '' && morning_shift !== '')
            {
                checkAvailableSchedule(doctor, date, morning_shift);
            } 
        }
    });

    $('#book2').on('click', function()
    {
        var doctor = $('#doctor_old').val();
        
        var date = $('#submitted_date_2').val();
        
        var evening_shift = $('#evening_shift_2').val();
        
        if(doctor !== 0 && date !== '' && evening_shift !== '')
        {
            checkAvailableSchedule(doctor, date, evening_shift);
        }
        else
        {
            var morning_shift = $('#morning_shift_2').val();
            
            if(doctor !== 0 && date !== '' && morning_shift !== '')
            {
                checkAvailableSchedule(doctor, date, morning_shift);
            } 
        }
    });

    // Appointment Date at both tabs
    $(".submitted_date").datepicker({dateFormat: 'yy-mm-dd', minDate: 0, maxDate: 6}).attr('readonly','readonly');
    
    // Appointment Date at New Patient tab
    $('#submitted_date_1, #submitted_date_2').change(function(){
        var date = $(this).val();
        id = $(this).attr('id');
        $.ajax({

            url: '/ams/f/appointment/get_doctors_by_date_lookup/' + date,
            success: function(data)
            {
                if(id == 'submitted_date_1')
                {
                    $('#doctor').html(data);
                    $('#doctor').selectpicker('refresh');
                }
                else
                {
                    if(id == 'submitted_date_2')
                    {
                        $('#doctor_old').html(data);
                        $('#doctor_old').selectpicker('refresh');
                    }
                }
            },
            error: function()
            {
                alert('Something went wrong!');
            }
        });
    });

    $('#doctor_search').on('click', function() {
        var specialization = $('#specialization').val();
        var specialization_length = specialization.length;
        if(specialization_length !== 0)
        { 
            searchDoctor(specialization);
        }
    });
});


    $(window).load(function() {

        $('#doctor').prevAll().eq(1).css('background', '#449D44');

        var $sfield = $('#old_cnic').autocomplete({
        select: function( event, ui ) 
        {
            if(ui.item.value === 'No Results Found')
            {
                ui.item.value = '';
            }
        },  
        change: function() {
            var old_cnic = $('#old_cnic').val();
            if(old_cnic.length > 0)
            {

                $.ajax({
                    url: '/ams/a/autocomplete/mr_number_autocomplete/',
                    method: 'post',
                    data: {'old_cnic': old_cnic},
                    success: function(data)
                    {
                        if(data.length !== 0)
                        {
                            var data = jQuery.parseJSON(data);
                            data = data[0]['mr_number'];
                            if(data === 'No Results Found')
                            {
                                $('#mr_number').val('');
                            }
                            else
                            {
                                $('#mr_number').val(data);
                            }
                        }
                    },
                    error: function()
                    {
                        alert('Something went wrong!');
                    }
                });
            }
        },          
        focus: function( event, ui ) 
        {
            if(ui.item.value === 'No Results Found')
            {
                ui.item.value = '';
            }
        },
        source: function(request, response)
        {   
            var url = "<?php echo site_url('a/autocomplete/cnic_autocomplete/'); ?>";
              $.post(url, {old_cnic:request.term}, function(old_cnic){
                response($.map(old_cnic, function(patient) {
                    return {
                        value: patient.cnic
                    };
                }).slice(0, 5));

              }, "json");  
        },

        minLength: 2,
        autofocus: true,

        });
        
        $sfield.autocomplete('option','change').call($sfield);
            
    });

</script>

<!-- Animate It -->
<script type="text/javascript" src="<?= FRONT_END_ASSETS ?>js/css3-animate-it.js"></script>
<!-- // Animate It -->

<!-- Custom General JS -->
<script type="text/javascript" src="<?= FRONT_END_ASSETS ?>js/custom-general.js"></script>
<!-- //  Custom General JS -->

<!-- //Java Scripts
================================= -->

</body>

</html>

